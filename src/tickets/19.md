---

# Вопрос 19: Резервное копирование БД. Процесс резервного копирования. Выполнение резервного копирования. Команда BACKUP DATABASE.

---

_РК - резервное копирование_

Выбор модели восстановления базы данных определяет объем данных, который может быть потерян во время разрушения базы данных, а также скорость использования, размер резервной копии протокола транзакций и период времени, необходимый для резервного копирования протокола

**Модели восстановления:**
* Полная (Full) - модель, при которой все операции записываются в протокол транзакций. Поэтому эта модель предоставляет полную защиту против сбоев внешних устройств.
* С неполным протоколированием (buk logged) - то же, что и полная модель восстановления, за тем исключением, что не ведется протоколирование массовых или bulk-операций. А резервные копии протокола транзакций содержат в этом случае результат такой операции.
* Простая (Simple) -  простой модели восстановления протокол транзакций усекается, если появляется точка восстановления. Но это не означает, что вообще не существует протоколирования, содержимое протокола используется во время создания контрольной точки, где все транзакции протокола подтверждены или для них выполнен откат.

**Полная резервная копия БД** содержит файлы данных и часть журнала транзакций. Полная РК представляет БД на момент создания РК и служит основным источником данных в случае сбоя системы.
При осуществлении полного РК выполняются:
* резервное копирование всех данных в БД;
* РК всех изменений, которые возникают во время выполнения РК;
* РК всех транзакций, не зафиксированных в журнале транзакций.

**Частичный синтаксис команды BACKUP DATABASE**
```sql
BACKUP DATABASE { database_name | @database_name_var }
  TO <backup_device> [ ,...n ]
  [ WITH [FORMAT] 
  [[,] {INIT|NOINIT}]]
```

При РК БД необходимо определить, должен ли файл РК перезаписываться или новые данные следует добавлять в этот файл. Если используется параметр NOINIT, резервная копия добавлется сервером SQL в существующий файл РК или в резервный набор данных (также, команда по умолчанию). Если используется параметр INIT, сервером перезаписываются все существующие данные на наборе резервных носителей, но сохраняются сведения заголовка.

Параметр FORMAT используется для перезаписи содержимого файла РК и резделения резервного набора данных. Когда указан параметр FORMAT во все файлы, используемые для этой операции резервного копирования, записывается заголовок нового носителя. При этом сервером SQL перезаписываются существющие носители и содержимое файла резервного копии.

Создание устройства РК с логическим именем AdventureWorksBack и выполняется полное резервное копирование БД AdventureWorks:
```sql
USE master
EXEC sp_addumpdevice 'disk', 'AdventureWorksBack',
'D:\MyBackupDir\AdventureWorksBack.bak'
BACKUP DATABASE AdventureWorks
  TO AdventureWorksBack
```

_Если что, информация о резервном копированиия есть еще в билете 20, возможно, это тоже нужно_