---

# Вопрос 20: Методы выполнения резервного копирования. Стратегии резервного копирования.

---
### Типы резервного копирования (РК):

**Full backup (Полное РК)** - создается резервная копия всех файлов данных и активная часть журнала транзакций.

   При осуществлении полного РК сервером выполняются следующие действия:
* резервное копирование всех данных в БД;
* РК всех изменений, которые возникают во время выполнения РК;
* РК всех транзакций, не зафиксированных в журнале транзакций.

```sql
BACKUP DATABASE AdventureWorks
  TO AdventureWorksBack
```

**Differential backup (Дифференциальное или разностное РК)** - создается копия только частей баз данных, которые менялись с момента последнего полного копирования БД.Разностное РК следует выполнять для минимазации времени, необходимого для восстановления часть изменяемой БД.

   При осуществлении разностного РК сервером выполняются следующие действия:
* создаются резервные копии частей БД, которые изменялись с момента выполнения полного РК;
* создаются резервные копии всех операций, происходящих во время разностного РК, а также всех транзакций, не зафиксированных в журнале транзакций.
  Разностное РК можно выполнить с помощью инструкции BACKUP DATABASE:

```sql
BACKUP DATABASE AdventureWorks
  TO DISK='D:\MyBackupDir\AdventureWorksBack.bak'
  WITH DIFFERENTIAL
```

**Transaction log (РК журнала транзакций** - учитываеются только изменения в БД, записанных в журнал транзакций (log файлы).

   При РК журнала транзакций сервером выполняются следующие действия:
* создаются резервные копии журнала транзакций от последней успешно выполненноой инструкции BACKUP LOG до конца текущего журнала транзакицй;
* усекается журнал транзакций до начала активной части журнала транзакций и отбрасываются сведения в неактивной части.
  Активная часть журнала транзакций начинается с момента самоц последней открытой транзакции и продолжается до конца журнала транзакций.
  
  РК журнала транзакицй выполняется с помощью инструкции BACKUP LOG
```sql
BACKUP LOG AdventureWorks
  TO AdventureWorksLog
```

**File, File group backup (РК файлов или файловых групп)** - позволяет копировать заданные файлы и файловые группы.

   При РК файлов и файловых групп сервером выполняются следующие действия:
* создаются резервные копии только тех файлов БД, которые указаны в параметре FILE или FILE GROUP;
* разрешается РК конкретных файлов БД вместо всей БД.
  При создании резервных копий файлов и файловых групп необходимо:
* указать логические файлы и файловые группы;
* создать резервные копии журнала транзакций, чтобы восстанавливаемые файлы согласовывались с остальной базой;
* создать план РК каждого файла на циклической основе, чтобы обеспечить регулярное РК всех файлов и файловых групп БД.

```sql
BACKUP DATABASE PhoneOrders
FILE=Orders2 TO OrderBackup2
BACKUP LOG PhoneOrders to  OrderBackupLog
```
**Partial backup (частичное РК)** - содержат все данные первичной файловой группы, всех файловых групп, доступных для чтения и записи, и из любых заданных файлов, доступных только для чтения.

```sql
BACKUP DATABASE AdventureWorks READ_WRITE_FILEGROUPS
  TO AWBackup
  ```

**Tail log backup (РК заключительного фрагмента журнала транзакций)** - это резервная копия журнала транзакций, вкоючающая часть журнала, которая ранее не подвергалась резервному копированию.

```sql
BACKUP LOG AdventureWorks
  TO DISK='D:\MyBackupDir\AdventureWorksBack.bak'
  WITH NORECOVERY, NO_TRUNCATE
```

**Copy Only (РК только для копирования)** - создание резервных копий данных, доступных только для копирования.

### Стратегия РК

**Стратигия РК** - последовательность типов резервного копирования.

**Стратегия полной резервной копии БД**
* Резервная копия всех данных и части журналов транзакций;
* Используется для восстановления всей БД.

**Стратегия РК журналов транзакций**
* включает в себя как минимум последнюю полную копию и копии журналов транзакций;
* позволяет восстановить БД на определенный момент времени;
* позволяет польностью восстановить БД.

**Стратегия дифференциального РК**
* включает выполнение полного и дифференциального РК БД;
* включает дифференциальную копию, содержащую только измененные данные;
* удобна, если часто меняется небольшое подмножество данных.
